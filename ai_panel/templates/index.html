<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI ãƒˆãƒªã‚ªå”è­°ã‚·ã‚¹ãƒ†ãƒ </title>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Hiragino Sans','Meiryo',sans-serif;background:#f0f2f5;color:#1a1a2e;min-height:100vh}

/* â”€â”€ ãƒ˜ãƒƒãƒ€ãƒ¼ â”€â”€ */
header{background:linear-gradient(135deg,#1a1a2e 0%,#16213e 60%,#0f3460 100%);color:#fff;padding:20px 32px;box-shadow:0 2px 12px rgba(0,0,0,.3)}
header h1{font-size:20px;font-weight:700;letter-spacing:1px}
header p{font-size:12px;color:rgba(255,255,255,.55);margin-top:4px}

/* â”€â”€ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ â”€â”€ */
main{max-width:1400px;margin:0 auto;padding:24px 16px}

/* â”€â”€ å…¥åŠ›ã‚«ãƒ¼ãƒ‰ â”€â”€ */
.input-card{background:#fff;border-radius:12px;padding:22px;box-shadow:0 2px 8px rgba(0,0,0,.08);margin-bottom:20px}
.input-card textarea{width:100%;min-height:90px;padding:13px;border:2px solid #e8eaed;border-radius:8px;font-size:15px;font-family:inherit;resize:vertical;line-height:1.7;transition:border-color .2s}
.input-card textarea:focus{outline:none;border-color:#4285f4}
.input-footer{display:flex;justify-content:space-between;align-items:center;margin-top:10px}
.input-footer .hint{font-size:12px;color:#999}
.btn-start{background:linear-gradient(135deg,#4285f4,#0f3460);color:#fff;border:none;border-radius:8px;padding:11px 30px;font-size:15px;font-weight:700;cursor:pointer;transition:transform .15s,opacity .15s}
.btn-start:hover:not(:disabled){transform:translateY(-1px);opacity:.92}
.btn-start:disabled{opacity:.5;cursor:not-allowed}

/* â”€â”€ å‚è€ƒè³‡æ–™æ¬„ â”€â”€ */
.context-wrap{margin-top:12px;border-top:1px solid #f0f2f5;padding-top:12px}
.context-toggle{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.context-label{font-size:13px;font-weight:600;color:#555;display:flex;align-items:center;gap:6px}
.btn-load-self{background:#f0f2f5;border:1px solid #ddd;border-radius:6px;padding:5px 12px;font-size:12px;cursor:pointer;color:#444;transition:background .15s}
.btn-load-self:hover{background:#e4e6e9}
.btn-load-self:disabled{opacity:.5;cursor:not-allowed}
.context-hint{font-size:11px;color:#aaa;margin-bottom:6px}
#context{width:100%;height:120px;padding:10px 13px;border:1px solid #e8eaed;border-radius:8px;font-size:12px;font-family:monospace;resize:vertical;color:#333;background:#fafbfc;line-height:1.6}
#context:focus{outline:none;border-color:#4285f4}

/* â”€â”€ ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ â”€â”€ */
.progress-wrap{display:none;justify-content:center;align-items:center;margin-bottom:22px}
.progress-wrap.show{display:flex}
.prog-step{display:flex;flex-direction:column;align-items:center;gap:5px}
.prog-circle{width:34px;height:34px;border-radius:50%;border:3px solid #ddd;background:#fff;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;color:#bbb;transition:all .3s}
.prog-step.active .prog-circle{border-color:#4285f4;background:#4285f4;color:#fff}
.prog-step.done   .prog-circle{border-color:#34a853;background:#34a853;color:#fff}
.prog-label{font-size:11px;color:#aaa;white-space:nowrap}
.prog-step.active .prog-label{color:#4285f4;font-weight:600}
.prog-step.done   .prog-label{color:#34a853}
.prog-line{width:64px;height:3px;background:#ddd;margin:0 6px 18px;transition:background .3s}
.prog-line.done{background:#34a853}

/* â”€â”€ ã‚¹ãƒ†ãƒƒãƒ—ã‚»ã‚¯ã‚·ãƒ§ãƒ³ â”€â”€ */
.step-section{display:none;margin-bottom:24px;animation:fadeUp .3s ease}
.step-section.show{display:block}
@keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.step-header{display:flex;align-items:center;gap:10px;margin-bottom:12px}
.step-badge{background:#1a1a2e;color:#fff;padding:3px 12px;border-radius:20px;font-size:11px;font-weight:700;letter-spacing:1px}
.step-title{font-size:17px;font-weight:700}

/* â”€â”€ AIã‚°ãƒªãƒƒãƒ‰ â”€â”€ */
.ai-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
@media(max-width:900px){.ai-grid{grid-template-columns:1fr}}

/* â”€â”€ AIã‚«ãƒ¼ãƒ‰ â”€â”€ */
.ai-card{background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,.08)}
.ai-card-header{display:flex;align-items:center;gap:9px;padding:12px 16px;color:#fff;font-weight:700;font-size:14px}
.ai-card.chatgpt .ai-card-header{background:#10a37f}
.ai-card.gemini  .ai-card-header{background:#4285f4}
.ai-card.claude  .ai-card-header{background:#c96442}
.ai-icon{width:26px;height:26px;background:rgba(255,255,255,.22);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:13px;flex-shrink:0}
.model-label{font-size:10px;opacity:.75;margin-left:auto}

.ai-card-body{padding:14px 16px;font-size:13.5px;line-height:1.8;color:#333;min-height:140px;max-height:380px;overflow-y:auto}
.ai-card-body.loading{display:flex;align-items:center;justify-content:center;gap:10px;color:#aaa;min-height:140px}
.spinner{width:18px;height:18px;border:3px solid #e0e0e0;border-top-color:#4285f4;border-radius:50%;animation:spin .7s linear infinite;flex-shrink:0}
@keyframes spin{to{transform:rotate(360deg)}}

.ai-stats{display:flex;gap:14px;padding:7px 16px;background:#f8f9fa;border-top:1px solid #eee;font-size:11px;color:#777}

/* ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³å†…ã‚¹ã‚¿ã‚¤ãƒ« */
.ai-card-body h1,.ai-card-body h2,.ai-card-body h3{font-size:14px;margin:10px 0 5px;color:#1a1a2e}
.ai-card-body p{margin-bottom:8px}
.ai-card-body ul,.ai-card-body ol{margin:5px 0 8px 18px}
.ai-card-body li{margin-bottom:3px}
.ai-card-body strong{color:#1a1a2e}
.ai-card-body code{background:#f0f2f5;padding:1px 5px;border-radius:3px;font-size:12px}

/* â”€â”€ è²¢çŒ®åº¦ãƒãƒ£ãƒ¼ãƒˆ â”€â”€ */
.contrib-card{background:#fff;border-radius:12px;padding:18px 22px;box-shadow:0 2px 8px rgba(0,0,0,.08);margin-bottom:16px}
.contrib-title{font-size:15px;font-weight:700;margin-bottom:14px;display:flex;align-items:center;gap:7px}
.contrib-row{display:flex;align-items:center;gap:10px;margin-bottom:10px}
.contrib-label{width:100px;font-size:12px;font-weight:600;color:#444;flex-shrink:0}
.contrib-bar-wrap{flex:1;background:#f0f2f5;border-radius:6px;height:22px;overflow:hidden}
.contrib-bar{height:100%;border-radius:6px;display:flex;align-items:center;padding-left:8px;font-size:11px;color:rgba(255,255,255,.9);font-weight:700;transition:width .9s cubic-bezier(.4,0,.2,1);min-width:28px}
.contrib-bar.chatgpt{background:#10a37f}
.contrib-bar.gemini {background:#4285f4}
.contrib-bar.claude {background:#c96442}
.contrib-meta{font-size:11px;color:#888;white-space:nowrap;width:160px;flex-shrink:0}

/* â”€â”€ æœ€çµ‚å›ç­” â”€â”€ */
.final-card{background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,.08)}
.final-card-header{background:linear-gradient(135deg,#1a1a2e,#0f3460);color:#fff;padding:14px 20px;font-weight:700;font-size:15px;display:flex;align-items:center;gap:8px}
.final-card-body{padding:20px;font-size:14.5px;line-height:1.85;color:#333}
.final-card-body h2{font-size:16px;font-weight:700;margin:16px 0 8px;color:#1a1a2e;border-bottom:2px solid #f0f2f5;padding-bottom:5px}
.final-card-body h3{font-size:14px;font-weight:700;margin:12px 0 5px;color:#444}
.final-card-body p{margin-bottom:9px}
.final-card-body ul,.final-card-body ol{margin:5px 0 9px 20px}
.final-card-body li{margin-bottom:4px}
.final-card-body strong{color:#1a1a2e}
</style>
</head>
<body>

<header>
  <h1>ğŸ¤– AI ãƒˆãƒªã‚ªå”è­°ã‚·ã‚¹ãƒ†ãƒ </h1>
  <p>ChatGPT Ã— Gemini Ã— Claude ãŒå”è­°ã—ã¦ãƒ™ã‚¹ãƒˆã‚¢ãƒ³ã‚µãƒ¼ã‚’å°ãå‡ºã—ã¾ã™</p>
</header>

<main>

  <!-- å…¥åŠ› -->
  <div class="input-card">
    <textarea id="question" placeholder="è³ªå•ãƒ»èª¿æŸ»å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„â€¦&#10;ä¾‹ï¼šã€Œæ—¥æœ¬ã®å°‘å­åŒ–å•é¡Œã®æ ¹æœ¬åŸå› ã¨åŠ¹æœçš„ãªå¯¾ç­–ã¯ï¼Ÿã€&#10;&#10;Shift+Enter ã§æ”¹è¡Œã€Enter ã§é€ä¿¡"></textarea>

    <!-- å‚è€ƒè³‡æ–™æ¬„ -->
    <div class="context-wrap">
      <div class="context-toggle">
        <span class="context-label">ğŸ“ å‚è€ƒè³‡æ–™ï¼ˆä»»æ„ï¼‰</span>
        <button class="btn-load-self" id="btn-load-self" onclick="loadSelf()">ğŸ”„ ã“ã®ã‚·ã‚¹ãƒ†ãƒ è‡ªèº«ã‚’èª­ã¿è¾¼ã‚€</button>
      </div>
      <div class="context-hint">ã“ã“ã«è²¼ã£ãŸãƒ†ã‚­ã‚¹ãƒˆï¼ˆã‚³ãƒ¼ãƒ‰ãƒ»ä»•æ§˜ãƒ»è³‡æ–™ãªã©ï¼‰ãŒ3è€…å…¨å“¡ã«æ¸¡ã•ã‚Œã¾ã™</div>
      <textarea id="context" placeholder="å‚è€ƒè³‡æ–™ã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘â€¦ï¼ˆç©ºæ¬„ã§ã‚‚OKï¼‰"></textarea>
    </div>

    <div class="input-footer">
      <span class="hint">3 AI Ã— 3ã‚¹ãƒ†ãƒƒãƒ—ã§å”è­° ï¼ 1å›ã‚ãŸã‚Šç´„ $0.02ã€œ0.10</span>
      <button class="btn-start" id="btn-start" onclick="startDiscussion()">ğŸš€ å”è­°é–‹å§‹</button>
    </div>
  </div>

  <!-- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ -->
  <div class="progress-wrap" id="progress-wrap">
    <div class="prog-step" id="prog1">
      <div class="prog-circle">1</div>
      <div class="prog-label">åˆå›å›ç­”</div>
    </div>
    <div class="prog-line" id="pline1"></div>
    <div class="prog-step" id="prog2">
      <div class="prog-circle">2</div>
      <div class="prog-label">ç›¸äº’ãƒ¬ãƒ“ãƒ¥ãƒ¼</div>
    </div>
    <div class="prog-line" id="pline2"></div>
    <div class="prog-step" id="prog3">
      <div class="prog-circle">3</div>
      <div class="prog-label">æœ€çµ‚çµ±åˆ</div>
    </div>
  </div>

  <!-- STEP 1 -->
  <div class="step-section" id="sec1">
    <div class="step-header">
      <div class="step-badge">STEP 1</div>
      <div class="step-title">å„AIã®åˆå›å›ç­”</div>
    </div>
    <div class="ai-grid">
      <div class="ai-card chatgpt">
        <div class="ai-card-header">
          <div class="ai-icon">ğŸ’¬</div>ChatGPT
          <span class="model-label" id="model-chatgpt"></span>
        </div>
        <div class="ai-card-body loading" id="s1-chatgpt"><div class="spinner"></div>å›ç­”ç”Ÿæˆä¸­â€¦</div>
        <div class="ai-stats" id="stat1-chatgpt" style="display:none">
          <span>ğŸ“ <b id="c1-chatgpt">-</b> å­—</span>
          <span>â“ <b id="q1-chatgpt">-</b> è³ªå•</span>
        </div>
      </div>
      <div class="ai-card gemini">
        <div class="ai-card-header">
          <div class="ai-icon">âœ¨</div>Gemini
        </div>
        <div class="ai-card-body loading" id="s1-gemini"><div class="spinner"></div>å›ç­”ç”Ÿæˆä¸­â€¦</div>
        <div class="ai-stats" id="stat1-gemini" style="display:none">
          <span>ğŸ“ <b id="c1-gemini">-</b> å­—</span>
          <span>â“ <b id="q1-gemini">-</b> è³ªå•</span>
        </div>
      </div>
      <div class="ai-card claude">
        <div class="ai-card-header">
          <div class="ai-icon">ğŸ§ </div>Claude
        </div>
        <div class="ai-card-body loading" id="s1-claude"><div class="spinner"></div>å›ç­”ç”Ÿæˆä¸­â€¦</div>
        <div class="ai-stats" id="stat1-claude" style="display:none">
          <span>ğŸ“ <b id="c1-claude">-</b> å­—</span>
          <span>â“ <b id="q1-claude">-</b> è³ªå•</span>
        </div>
      </div>
    </div>
  </div>

  <!-- STEP 2 -->
  <div class="step-section" id="sec2">
    <div class="step-header">
      <div class="step-badge">STEP 2</div>
      <div class="step-title">ç›¸äº’ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆä»–ã®AIã®å›ç­”ã‚’èª­ã‚“ã§è¿½è¨˜ãƒ»ä¿®æ­£ï¼‰</div>
    </div>
    <div class="ai-grid">
      <div class="ai-card chatgpt">
        <div class="ai-card-header"><div class="ai-icon">ğŸ’¬</div>ChatGPT ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼</div>
        <div class="ai-card-body loading" id="s2-chatgpt"><div class="spinner"></div>ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”Ÿæˆä¸­â€¦</div>
        <div class="ai-stats" id="stat2-chatgpt" style="display:none">
          <span>ğŸ“ <b id="c2-chatgpt">-</b> å­—</span>
          <span>â“ <b id="q2-chatgpt">-</b> è³ªå•</span>
        </div>
      </div>
      <div class="ai-card gemini">
        <div class="ai-card-header"><div class="ai-icon">âœ¨</div>Gemini ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼</div>
        <div class="ai-card-body loading" id="s2-gemini"><div class="spinner"></div>ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”Ÿæˆä¸­â€¦</div>
        <div class="ai-stats" id="stat2-gemini" style="display:none">
          <span>ğŸ“ <b id="c2-gemini">-</b> å­—</span>
          <span>â“ <b id="q2-gemini">-</b> è³ªå•</span>
        </div>
      </div>
      <div class="ai-card claude">
        <div class="ai-card-header"><div class="ai-icon">ğŸ§ </div>Claude ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼</div>
        <div class="ai-card-body loading" id="s2-claude"><div class="spinner"></div>ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”Ÿæˆä¸­â€¦</div>
        <div class="ai-stats" id="stat2-claude" style="display:none">
          <span>ğŸ“ <b id="c2-claude">-</b> å­—</span>
          <span>â“ <b id="q2-claude">-</b> è³ªå•</span>
        </div>
      </div>
    </div>
  </div>

  <!-- STEP 3 -->
  <div class="step-section" id="sec3">
    <div class="step-header">
      <div class="step-badge">STEP 3</div>
      <div class="step-title">æœ€çµ‚çµ±åˆå›ç­” &amp; è²¢çŒ®åº¦åˆ†æ</div>
    </div>

    <!-- è²¢çŒ®åº¦ãƒãƒ£ãƒ¼ãƒˆ -->
    <div class="contrib-card" id="contrib-card" style="display:none">
      <div class="contrib-title">ğŸ“Š è²¢çŒ®åº¦æ¯”è¼ƒï¼ˆæ–‡å­—æ•°ãƒ»è³ªå•æ•°ãƒ™ãƒ¼ã‚¹ï¼‰</div>
      <div class="contrib-row">
        <div class="contrib-label">ğŸ’¬ ChatGPT</div>
        <div class="contrib-bar-wrap"><div class="contrib-bar chatgpt" id="bar-chatgpt" style="width:0%">-</div></div>
        <div class="contrib-meta" id="meta-chatgpt">-</div>
      </div>
      <div class="contrib-row">
        <div class="contrib-label">âœ¨ Gemini</div>
        <div class="contrib-bar-wrap"><div class="contrib-bar gemini" id="bar-gemini" style="width:0%">-</div></div>
        <div class="contrib-meta" id="meta-gemini">-</div>
      </div>
      <div class="contrib-row">
        <div class="contrib-label">ğŸ§  Claude</div>
        <div class="contrib-bar-wrap"><div class="contrib-bar claude" id="bar-claude" style="width:0%">-</div></div>
        <div class="contrib-meta" id="meta-claude">-</div>
      </div>
    </div>

    <!-- æœ€çµ‚å›ç­” -->
    <div class="final-card">
      <div class="final-card-header">ğŸ† æœ€çµ‚çµ±åˆå›ç­”ï¼ˆGPT-4o ã«ã‚ˆã‚‹çµ±åˆï¼‰</div>
      <div class="final-card-body" id="final-body">
        <div style="display:flex;align-items:center;gap:12px;color:#aaa;justify-content:center;padding:40px">
          <div class="spinner"></div>çµ±åˆå›ç­”ã‚’ç”Ÿæˆä¸­â€¦
        </div>
      </div>
    </div>
  </div>

</main>

<script src="https://cdn.jsdelivr.net/npm/marked@9/marked.min.js"></script>
<script>
marked.use({ breaks: true, gfm: true });

const $  = id => document.getElementById(id);
const AIs = ['chatgpt', 'gemini', 'claude'];

let s1Data = null, s2Data = null;

// â”€â”€ ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function countChars(t)     { return (t || '').length; }
function countQuestions(t) { return ((t || '').match(/[ï¼Ÿ?]|ã€è³ªå•ã€‘/g) || []).length; }

function setProgress(step) {
  [1,2,3].forEach(n => {
    const el = $('prog'+n);
    if (n < step) {
      el.className = 'prog-step done';
      el.querySelector('.prog-circle').textContent = 'âœ“';
    } else if (n === step) {
      el.className = 'prog-step active';
    } else {
      el.className = 'prog-step';
      el.querySelector('.prog-circle').textContent = n;
    }
    if (n < 3) $('pline'+n).className = n < step ? 'prog-line done' : 'prog-line';
  });
}

function renderCard(bodyId, statId, cId, qId, text) {
  const el = $(bodyId);
  el.className = 'ai-card-body';
  el.innerHTML = marked.parse(text || 'âš ï¸ å–å¾—å¤±æ•—');
  $(cId).textContent = countChars(text).toLocaleString();
  $(qId).textContent = countQuestions(text);
  $(statId).style.display = 'flex';
}

function renderContrib(s1, s2) {
  const scores = {}, qs = {};
  AIs.forEach(n => {
    scores[n] = countChars(s1[n]) + countChars(s2[n]);
    qs[n]     = countQuestions(s1[n]) + countQuestions(s2[n]);
  });
  const total = Object.values(scores).reduce((a,b)=>a+b,0) || 1;
  $('contrib-card').style.display = 'block';
  AIs.forEach(n => {
    const pct = Math.round(scores[n]/total*100);
    const bar = $('bar-'+n);
    bar.textContent = pct+'%';
    setTimeout(() => bar.style.width = pct+'%', 50);
    $('meta-'+n).textContent = `ç·å­—æ•° ${scores[n].toLocaleString()} ï¼ è³ªå• ${qs[n]}ä»¶`;
  });
}

async function post(url, data) {
  const r = await fetch(url, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  });
  if (!r.ok) throw new Error(`ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼: HTTP ${r.status}`);
  return r.json();
}

function scrollTo(id) {
  setTimeout(() => $(id).scrollIntoView({ behavior:'smooth', block:'start' }), 80);
}

function resetCards() {
  AIs.forEach(n => {
    ['s1-','s2-'].forEach(p => {
      const el = $(p+n);
      if (el) { el.className='ai-card-body loading'; el.innerHTML='<div class="spinner"></div>ç”Ÿæˆä¸­â€¦'; }
      const st = $(p.replace('-','')+'-'+n+'-stats') || $('stat'+(p==='s1-'?1:2)+'-'+n);
      if (st) st.style.display='none';
    });
  });
  $('contrib-card').style.display = 'none';
  $('final-body').innerHTML = '<div style="display:flex;align-items:center;gap:12px;color:#aaa;justify-content:center;padding:40px"><div class="spinner"></div>çµ±åˆå›ç­”ã‚’ç”Ÿæˆä¸­â€¦</div>';
  ['sec1','sec2','sec3'].forEach(id => $(id).classList.remove('show'));
}

// â”€â”€ ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã‚’èª­ã¿è¾¼ã‚€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadSelf() {
  const btn = $('btn-load-self');
  btn.disabled = true;
  btn.textContent = 'â³ èª­ã¿è¾¼ã¿ä¸­â€¦';
  try {
    const data = await fetch('/api/load-self').then(r => r.json());
    const text = Object.entries(data)
      .map(([name, code]) => `=== ${name} ===\n${code}`)
      .join('\n\n');
    $('context').value = text;
    btn.textContent = 'âœ… èª­ã¿è¾¼ã¿å®Œäº†';
    setTimeout(() => { btn.textContent = 'ğŸ”„ ã“ã®ã‚·ã‚¹ãƒ†ãƒ è‡ªèº«ã‚’èª­ã¿è¾¼ã‚€'; btn.disabled = false; }, 2000);
  } catch(e) {
    alert('èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ' + e.message);
    btn.textContent = 'ğŸ”„ ã“ã®ã‚·ã‚¹ãƒ†ãƒ è‡ªèº«ã‚’èª­ã¿è¾¼ã‚€';
    btn.disabled = false;
  }
}

// â”€â”€ ãƒ¡ã‚¤ãƒ³å‡¦ç† â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function startDiscussion() {
  const question = $('question').value.trim();
  if (!question) { alert('è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
  const context = $('context').value.trim();

  $('btn-start').disabled = true;
  $('btn-start').textContent = 'â³ å”è­°ä¸­â€¦';
  $('progress-wrap').classList.add('show');
  resetCards();

  try {
    // â”€â”€ STEP 1 â”€â”€
    setProgress(1);
    $('sec1').classList.add('show');

    s1Data = await post('/api/step1', { question, context });
    AIs.forEach(n => renderCard(`s1-${n}`, `stat1-${n}`, `c1-${n}`, `q1-${n}`, s1Data[n]));

    // â”€â”€ STEP 2 â”€â”€
    setProgress(2);
    $('sec2').classList.add('show');
    scrollTo('sec2');

    s2Data = await post('/api/step2', { question, context, step1: s1Data });
    AIs.forEach(n => renderCard(`s2-${n}`, `stat2-${n}`, `c2-${n}`, `q2-${n}`, s2Data[n]));

    // â”€â”€ STEP 3 â”€â”€
    setProgress(3);
    $('sec3').classList.add('show');
    scrollTo('sec3');
    renderContrib(s1Data, s2Data);

    const s3 = await post('/api/step3', { question, context, step1: s1Data, step2: s2Data });
    $('final-body').innerHTML = marked.parse(s3.result || 'âš ï¸ å–å¾—å¤±æ•—');

  } catch(e) {
    alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:\n' + e.message);
  } finally {
    $('btn-start').disabled = false;
    $('btn-start').textContent = 'ğŸš€ å”è­°é–‹å§‹';
  }
}

// Enteré€ä¿¡ / Shift+Enteræ”¹è¡Œ
$('question').addEventListener('keydown', e => {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    if (!$('btn-start').disabled) startDiscussion();
  }
});
</script>
</body>
</html>
